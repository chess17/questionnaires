{"version":3,"sources":["injector.js","address.js","core.js","hiddenToggle.js","http.js","table.js","text.js","questionnaire.js"],"names":["injector","deps","resolve","constructor","$","type","err","length","dependencies","slice","map","creator","apply","storedConstructor","expose","key","window","address","prototype","path","location","pathname","pathParts","this","split","document","fetch","hiddenToggle","id","_id","hide","setHidden","show","hidden","el","getElementById","http","options","_opts","get","url","opts","extend","method","getJson","adjustedUrl","substring","then","r","ok","json","Error","status","table","bind","data","refreshStructure","render","anchor","header","horizontal","cols","col","title","join","generateHeader","body","cells","concat","_toConsumableArray","dataElement","value","format","val","element","generateBody","wrapper","innerHTML","linkFormat","target","propertyFormat","listFormat","listItemFormat","items","property","liGenerator","generateLi","ulGenerator","generateUl","mappedItems","i","text","textContent","Http","Address","Table","HiddenToggle","Text","spinnerHiddenToggle","questionTable","scoreFormat","questionTableHiddenToggle","detailsTable","minimum","maximum","label","detailsTableHiddenToggle","titleText","subtitleText","score","questionnaire","questions","name","description","subtitleHiddenToggle"],"mappings":"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","file":"questionnaire.js","sourcesContent":["const injector = (function() {\n  'use strict';\n\n  const deps = {};\n\n  function resolve(constructor) {\n    if ($.type(constructor) === \"function\") {\n      try {\n\treturn new constructor();\n      } catch (err) {\n        return constructor;\n      }\n    } else if ($.type(constructor) === \"array\" && $.type(constructor[constructor.length - 1]) === \"function\") {\n      const dependencies = constructor.slice(0, -1).map(resolve);\n      const creator = constructor[constructor.length - 1];\n      return creator.apply(creator, dependencies);\n    } else if ($.type(constructor) === \"string\") {\n      const storedConstructor = deps[constructor];\n      if (storedConstructor) {\n        return resolve(storedConstructor);\n      }\n    } else {\n      return constructor;\n    }\n  }\n\n  function expose(key, constructor) {\n    deps[key] = constructor;\n  }\n\n  return {\n    resolve: resolve,\n    expose: expose\n  };\n})();\n\nconst resolve = injector.resolve;\nconst expose = injector.expose;\n","expose('address', ['window', function(window) {\n  'use strict';\n\n  function address() {\n  }\n\n  address.prototype.path = function() {\n    return window.location.pathname;\n  }\n\n  address.prototype.pathParts = function() {\n    return this.path().split('/');\n  }\n\n  return address;\n}]);\n","(function() {\n  'use strict';\n  expose('document', document);\n  expose('window', window);\n  expose('fetch', fetch);\n})();\n","expose('hiddenToggle', ['document', (function(document) {\n  'use strict';\n\n  function hiddenToggle(id) {\n    this._id = id;\n  }\n\n  hiddenToggle.prototype.hide = function() {\n    setHidden(this._id, true);\n  }\n\n  hiddenToggle.prototype.show = function() {\n    setHidden(this._id, false);\n  }\n\n  function setHidden(id, hidden) {\n    const el = document.getElementById(id);\n    if (el) {\n      el.hidden = hidden;\n    }\n  }\n\n  return hiddenToggle;\n})]);\n","expose('http', ['fetch', function(fetch) {\n  'use strict';\n\n  function http(options) {\n    this._opts = options || {};\n  }\n\n  http.prototype.get = function(url) {\n    const opts = $.extend(true, {}, this._opts);\n    opts.method = 'GET';\n    return fetch(url, opts);\n  }\n\n  http.prototype.getJson = function(url) {\n    const adjustedUrl = url.substring(url.length - 5) === '.json' ? url : url + '.json';\n    return this.get(adjustedUrl).then(r => {\n      if (r.ok) {\n        return r.json();\n      } else {\n\tthrow new Error(`Bad response ${r.status}`);\n      }\n    });\n  }\n\n  return http;\n\n}]);\n","expose('table', ['document', function(document) {\n  'use strict';\n\n  function table(id, options) {\n    this._id = id;\n    this._opts = options;\n  }\n\n  table.prototype.bind = function(data, refreshStructure) {\n    this.data = data;\n  }\n\n  table.prototype.render = function() {\n    const anchor = document.getElementById(this._id);\n    if (anchor) {\n      const header = generateHeader(this._opts);\n      const body = generateBody(this._opts, this.data);\n      const wrapper = generateTable(this._opts, header, body);\n      anchor.innerHTML = wrapper;\n    }\n  }\n\n  table.linkFormat = function(opts) {\n    return function(value, element) {\n      return `<a href=\"${value}\" ${opts.target ? `target=\"${opts.target}\"` : \"\"}>${value}</a>`;\n    }\n  }\n\n  table.propertyFormat = function(key) {\n    return function(value, element) {\n      return value[key];\n    }\n  }\n\n  table.listFormat = function(listItemFormat, opts) {\n    return function(value, element) {\n      const items = opts.property ? value[opts.property] : value;\n      const liGenerator = opts.generateLi || (() => '<li>');\n      const ulGenerator = opts.generateUl || (() => '<ul>');\n      const mappedItems = items.map(i => `${liGenerator(i)}${listItemFormat(i)}</li>`).join('');\n      return `${ulGenerator()}${mappedItems}</ul>`;\n    }\n  }\n\n  function generateHeader(opts) {\n    function generateHeaderCell(col) {\n      return `<th>${col.title}</th>`;\n    }\n\n    if (opts.horizontal) {\n      return '';\n    }\n    const headers = opts.cols.map(generateHeaderCell).join('');\n    return `<thead><tr>${headers}</tr></thead>`;\n  }\n\n  function generateBody(opts, data) {\n    function generateVerticalRow(dataElement) {\n      function generateCell(col) {\n        const value = dataElement[col.key];\n\t    col.format = col.format || ((val, element) => val);\n\t    const formattedValue = col.format(value, dataElement);\n\t    return `<td>${formattedValue}</td>`;\n      }\n\n      const cells = opts.cols.map(generateCell).join('');\n      return `<tr>${cells}</tr>`;\n    }\n\n    function generateHorizontalRow(data) {\n      return function(col) {\n        function generateCell(dataElement) {\n          const value = dataElement[col.key];\n          col.format = col.format || ((val, element) => val);\n          const formattedValue = col.format(value, dataElement);\n          return `<td>${formattedValue}</td>`;\n        }\n\n        function generateHeaderCell() {\n          return `<td>${col.title}</td>`;\n        }\n\n        const cells = [generateHeaderCell(), ...data.map(generateCell)].join('');\n        return `<tr>${cells}</tr>`;\n      }\n    }\n\n    const body = opts.horizontal ? opts.cols.map(generateHorizontalRow(data)) : data.map(generateVerticalRow);\n    return `<tbody>${body.join('')}</tbody>`;\n  }\n\n  function generateTable(opts, header, body) {\n    return `<div class=\"table-wrapper\"><table>${header}${body}</table></div>`\n  }\n\n  return table;\n}]);\n","expose('text', ['document', function(document) {\n  'use strict';\n\n  function text(id) {\n    this.id = id;\n  }\n\n  text.prototype.render = function(text) {\n    const el = document.getElementById(this.id);\n    if (el) {\n      el.textContent = text;\n    }\n  }\n\n  return text;\n\n}]);\n","resolve(['http', 'address', 'table', 'hiddenToggle', 'text', function(Http, Address, Table, HiddenToggle, Text) {\n  'use strict';\n\n  const spinnerHiddenToggle = new HiddenToggle('spinner');\n  const questionTable = new Table('questionnaireTable', {\n    cols: [\n      { title: 'Question', key: 'text' },\n      { title: 'Left score', key: 'left', format: scoreFormat },\n      { title: 'Right score', key: 'right', format: scoreFormat },\n      { title: 'Categories', key: 'categories' }\n    ]\n  });\n  const questionTableHiddenToggle = new HiddenToggle('questionnaireTable');\n  const detailsTable = new Table('detailTable', {\n    cols: [\n      { title: 'PDF Link', key: 'pdfLink', format: Table.linkFormat({target: \"_blank\"}) },\n      { title: 'Sectors', key: 'sectors' },\n      { title: 'Demographic', key: 'demographic' },\n      { title: 'Scoring', key: 'scoring', format: Table.propertyFormat('aggregation') },\n      { title: 'Scoring bands', key: 'scoring', format: Table.listFormat(i => `${i.minimum} - ${i.maximum}: ${i.label}`, {\n        generateUl: () => `<ul class=\"alt\">`,\n        property: 'bands'\n      })}\n    ],\n    horizontal: true\n  });\n  const detailsTableHiddenToggle = new HiddenToggle('detailTable');\n  const titleText = new Text('title');\n  const subtitleText = new Text('subtitle');\n  const subtitleHiddenToggle = new HiddenToggle('subtitle');\n\n  function scoreFormat(value, element) {\n    return `${value.label} (${value.score})`;\n  }\n\n  const questionnaire = (function() {\n    const pathParts = new Address().pathParts();\n    return pathParts[pathParts.length - 1];\n  })();\n\n  new Http().getJson(`/api/questionnaire/${questionnaire}`).then(r => {\n    questionTable.bind(r.questions);\n    questionTable.render();\n    detailsTable.bind([r]);\n    detailsTable.render();\n    titleText.render(r.name);\n    subtitleText.render(r.description);\n    spinnerHiddenToggle.hide();\n    questionTableHiddenToggle.show();\n    detailsTableHiddenToggle.show();\n    subtitleHiddenToggle.show();\n  });\n}]);\n"]}